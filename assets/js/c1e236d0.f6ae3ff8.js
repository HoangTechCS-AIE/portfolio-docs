"use strict";(self.webpackChunkportfolio_docs=self.webpackChunkportfolio_docs||[]).push([[7801],{7292(e,n,r){r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"smartcity/architecture","title":"System Architecture","description":"Pull-based Architecture","source":"@site/docs/smartcity/architecture.md","sourceDirName":"smartcity","slug":"/smartcity/architecture","permalink":"/portfolio-docs/docs/smartcity/architecture","draft":false,"unlisted":false,"editUrl":"https://github.com/your-username/portfolio-docs/tree/main/docs/smartcity/architecture.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"smartcitySidebar","previous":{"title":"SmartCity Platform Overview","permalink":"/portfolio-docs/docs/smartcity/overview"},"next":{"title":"ML Classification","permalink":"/portfolio-docs/docs/smartcity/ml-classification"}}');var s=r(4848),a=r(8453);const t={sidebar_position:2},l="System Architecture",o={},c=[{value:"Pull-based Architecture",id:"pull-based-architecture",level:2},{value:"Component Architecture",id:"component-architecture",level:2},{value:"1. Data Generation Layer",id:"1-data-generation-layer",level:3},{value:"2. Edge Storage Layer",id:"2-edge-storage-layer",level:3},{value:"3. Core Processing Layer",id:"3-core-processing-layer",level:3},{value:"4. ML Classification Layer",id:"4-ml-classification-layer",level:3},{value:"5. Tiered Storage Layer",id:"5-tiered-storage-layer",level:3},{value:"Data Flow Visualization",id:"data-flow-visualization",level:2},{value:"Deployment Architecture",id:"deployment-architecture",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"system-architecture",children:"System Architecture"})}),"\n",(0,s.jsx)(n.h2,{id:"pull-based-architecture",children:"Pull-based Architecture"}),"\n",(0,s.jsx)(n.mermaid,{value:'sequenceDiagram\n    autonumber\n    participant SIM as IoT Simulator\n    participant RMQ as RabbitMQ\n    participant BE as Spring Boot Backend\n    participant ML as ML Service\n    participant REDIS as Redis (HOT)\n    participant MONGO as MongoDB (WARM/COLD)\n    \n    Note over SIM: Generate sensor data\n    SIM->>RMQ: Publish messages\n    \n    Note over BE: Scheduled pull (every 10s)\n    BE->>RMQ: Pull batch (5000 msg)\n    RMQ--\x3e>BE: Message batch\n    \n    loop For each message\n        BE->>ML: POST /predict {sensor_data}\n        ML--\x3e>BE: {label: "HOT/WARM/COLD"}\n    end\n    \n    BE->>REDIS: Store HOT records (TTL 1h)\n    BE->>MONGO: Bulk insert WARM records\n    BE->>MONGO: Bulk insert COLD records'}),"\n",(0,s.jsx)(n.h2,{id:"component-architecture",children:"Component Architecture"}),"\n",(0,s.jsx)(n.h3,{id:"1-data-generation-layer",children:"1. Data Generation Layer"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Python IoT Simulator"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# Simulate Temperature sensor\ndef generate_temperature():\n    if random() < 0.35:  # 35% anomalies\n        return uniform(40, 50)  # HOT anomaly\n    else:\n        return uniform(15, 35)  # Normal range\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Configuration"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"40M total messages"}),"\n",(0,s.jsx)(n.li,{children:"1000 simulated sensors"}),"\n",(0,s.jsx)(n.li,{children:"20 concurrent threads"}),"\n",(0,s.jsx)(n.li,{children:"Random distribution"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"2-edge-storage-layer",children:"2. Edge Storage Layer"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"RabbitMQ Clustering"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"2 nodes for high availability"}),"\n",(0,s.jsxs)(n.li,{children:["Queue: ",(0,s.jsx)(n.code,{children:"smart_city_queue"})]}),"\n",(0,s.jsx)(n.li,{children:"Durable messages"}),"\n",(0,s.jsx)(n.li,{children:"Ports: 5672, 5673 (AMQP), 15672, 15673 (Management UI)"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Benefits of Pull"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 No backend overload during spikes"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Controlled batch processing"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Resilient if one node fails"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"3-core-processing-layer",children:"3. Core Processing Layer"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Spring Boot Backend"}),":"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Scheduled Pull"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"@Scheduled(fixedRate = 10000) // Every 10 seconds\npublic void pullMessages() {\n    List<Message> batch = rabbitTemplate.receive(5000);\n    \n    // Classify with ML\n    List<ClassifiedData> classified = mlService.classifyBatch(batch);\n    \n    // Route to appropriate storage\n    routeToTieredStorage(classified);\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Tiered Routing Logic"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'void routeToTieredStorage(List<ClassifiedData> data) {\n    List<Data> hotData = filterByLabel(data, "HOT");\n    List<Data> warmData = filterByLabel(data, "WARM");\n    List<Data> coldData = filterByLabel(data, "COLD");\n    \n    redisTemplate.opsForValue().set(hotData);  // TTL 3600s\n    warmMongoTemplate.insertAll(warmData);\n    coldMongoTemplate.insertAll(coldData);\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"4-ml-classification-layer",children:"4. ML Classification Layer"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"FastAPI ML Service"}),":"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"IsolationForest Models"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"temperature_model.pkl"})," (1.5 MB)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"humidity_model.pkl"})," (1.59 MB)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"co2_model.pkl"})," (1.9 MB)"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Prediction Endpoint"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'@app.post("/predict")\ndef predict(data: SensorData):\n    metric_type = data.metric_type\n    value = data.value\n    \n    # Load appropriate model\n    model = models[metric_type]\n    \n    # Predict anomaly (-1 = anomaly, 1 = normal)\n    prediction = model.predict([[value]])[0]\n    \n    if prediction == -1:\n        return {"label": "HOT", "uri": "https://schema.org/Warning"}\n    else:\n        return {"label": "COLD", "uri": "https://schema.org/Normal"}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"5-tiered-storage-layer",children:"5. Tiered Storage Layer"}),"\n",(0,s.jsx)(n.mermaid,{value:'graph TB\n    subgraph "Storage Tiers"\n        subgraph "HOT - Redis"\n            R1[In-Memory Cache]\n            R2[TTL: 3600s]\n            R3[Fast Read <1ms]\n        end\n        \n        subgraph "WARM - MongoDB"\n            W1[Important Data]\n            W2[Indexed]\n            W3[7-day retention]\n        end\n        \n        subgraph "COLD - MongoDB"\n            C1[Normal Data]\n            C2[Compressed]\n            C3[Long-term storage]\n        end\n    end\n    \n    ROUTE[Classification Router] --\x3e R1\n    ROUTE --\x3e W1\n    ROUTE --\x3e C1\n    \n    style R1 fill:#DC382D,color:#fff\n    style W1 fill:#4DB33D,color:#fff\n    style C1 fill:#4169E1,color:#fff'}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Redis Configuration"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"redis:\n  host: localhost\n  port: 6379\n  ttl: 3600  # 1 hour\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"MongoDB Multi-Datasource"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"spring:\n  data:\n    mongodb:\n      warm:\n        uri: mongodb://localhost:27018/warm_db\n      cold:\n        uri: mongodb://localhost:27019/cold_db\n"})}),"\n",(0,s.jsx)(n.h2,{id:"data-flow-visualization",children:"Data Flow Visualization"}),"\n",(0,s.jsx)(n.mermaid,{value:"flowchart LR\n    A[Sensor Data] --\x3e B{ML Classification}\n    \n    B --\x3e|35% Anomaly| C[HOT Label]\n    B --\x3e|0%| D[WARM Label]\n    B --\x3e|65% Normal| E[COLD Label]\n    \n    C --\x3e F[Redis Fast Access TTL 1h]\n    D --\x3e G[MongoDB warm_db Indexed 7-day retention]\n    E --\x3e H[MongoDB cold_db Compressed Long-term]\n    \n    style C fill:#ff6b6b,color:#fff\n    style F fill:#DC382D,color:#fff\n    style G fill:#4DB33D,color:#fff\n    style H fill:#4169E1,color:#fff"}),"\n",(0,s.jsx)(n.h2,{id:"deployment-architecture",children:"Deployment Architecture"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Docker Compose Services"}),":"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"edge-rabbitmq-1"}),", ",(0,s.jsx)(n.code,{children:"edge-rabbitmq-2"})," - Message queues"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"core-redis-hot"})," - HOT tier cache"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"core-mongo-warm"})," - WARM tier database"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"core-mongo-cold"})," - COLD tier database"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"smart-city-backend"})," - Spring Boot API"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"smart-city-ml"})," - ML classification service"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"smart-city-frontend"})," - Nuxt.js dashboard"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Port Mapping"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"3000  - Frontend\n5672/5673  - RabbitMQ AMQP\n6379  - Redis\n8000  - ML Service\n8080  - Backend API\n15672/15673 - RabbitMQ UI\n27018/27019 - MongoDB instances\n"})}),"\n",(0,s.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"./ml-classification",children:"ML Classification Deep Dive \u2192"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"./tech-stack",children:"Technology Stack \u2192"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);