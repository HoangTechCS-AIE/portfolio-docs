"use strict";(self.webpackChunkportfolio_docs=self.webpackChunkportfolio_docs||[]).push([[6964],{8929(e,n,i){i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"smartcity/ml-classification","title":"ML Classification","description":"IsolationForest Algorithm","source":"@site/docs/smartcity/ml-classification.md","sourceDirName":"smartcity","slug":"/smartcity/ml-classification","permalink":"/portfolio-docs/en/docs/smartcity/ml-classification","draft":false,"unlisted":false,"editUrl":"https://github.com/your-username/portfolio-docs/tree/main/docs/smartcity/ml-classification.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"smartcitySidebar","previous":{"title":"System Architecture","permalink":"/portfolio-docs/en/docs/smartcity/architecture"},"next":{"title":"Technology Stack","permalink":"/portfolio-docs/en/docs/smartcity/tech-stack"}}');var t=i(4848),r=i(8453);const l={sidebar_position:3},o="ML Classification",a={},d=[{value:"IsolationForest Algorithm",id:"isolationforest-algorithm",level:2},{value:"Why IsolationForest?",id:"why-isolationforest",level:3},{value:"How It Works",id:"how-it-works",level:3},{value:"Three Classification Models",id:"three-classification-models",level:2},{value:"1. Temperature Model",id:"1-temperature-model",level:3},{value:"2. Humidity Model",id:"2-humidity-model",level:3},{value:"3. CO2 Model",id:"3-co2-model",level:3},{value:"ML Service Architecture",id:"ml-service-architecture",level:2},{value:"API Endpoint",id:"api-endpoint",level:2},{value:"POST /predict",id:"post-predict",level:3},{value:"Auto-Training on Startup",id:"auto-training-on-startup",level:2},{value:"Data Distribution",id:"data-distribution",level:2},{value:"Performance Metrics",id:"performance-metrics",level:2},{value:"Classification Flow in Backend",id:"classification-flow-in-backend",level:2},{value:"WARM Tier (Future Enhancement)",id:"warm-tier-future-enhancement",level:2},{value:"Next Steps",id:"next-steps",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"ml-classification",children:"ML Classification"})}),"\n",(0,t.jsx)(n.h2,{id:"isolationforest-algorithm",children:"IsolationForest Algorithm"}),"\n",(0,t.jsx)(n.h3,{id:"why-isolationforest",children:"Why IsolationForest?"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"IsolationForest"})," l\xe0 unsupervised anomaly detection algorithm:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u2705 Kh\xf4ng c\u1ea7n labeled data"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Hi\u1ec7u qu\u1ea3 v\u1edbi high-dimensional data"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Fast training v\xe0 inference"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Robust v\u1edbi outliers"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"how-it-works",children:"How It Works"}),"\n",(0,t.jsx)(n.mermaid,{value:"graph TB\n    A[Training Data Normal sensor readings] --\x3e B[Build Isolation Trees]\n    B --\x3e C[Calculate Anomaly Scores]\n    \n    D[New Sensor Reading] --\x3e E{Anomaly Score}\n    E --\x3e|Score > Threshold| F[ANOMALY Label: HOT]\n    E --\x3e|Score <= Threshold| G[NORMAL Label: COLD]\n    \n    style F fill:#ff6b6b,color:#fff\n    style G fill:#4169E1,color:#fff"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Principle"}),": Anomalies are easier to isolate (fewer splits needed in decision tree)"]}),"\n",(0,t.jsx)(n.h2,{id:"three-classification-models",children:"Three Classification Models"}),"\n",(0,t.jsx)(n.h3,{id:"1-temperature-model",children:"1. Temperature Model"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Training Range"}),": 15-35\xb0C (normal urban temperature)"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Training Code"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"from sklearn.ensemble import IsolationForest\n\n# Generate normal training data\nnormal_temps = np.random.uniform(15, 35, 10000)\n\n# Train model\ntemp_model = IsolationForest(contamination=0.1, random_state=42)\ntemp_model.fit(normal_temps.reshape(-1, 1))\n\n# Save model\njoblib.dump(temp_model, 'temperature_model.pkl')\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Detection"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\ud83d\udd25 ",(0,t.jsx)(n.strong,{children:"HOT"}),": >38\xb0C or <10\xb0C (extreme heat/cold)"]}),"\n",(0,t.jsxs)(n.li,{children:["\u2744\ufe0f ",(0,t.jsx)(n.strong,{children:"COLD"}),": 15-35\xb0C (normal range)"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"2-humidity-model",children:"2. Humidity Model"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Training Range"}),": 30-80% (normal humidity)"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Detection"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\ud83d\udd25 ",(0,t.jsx)(n.strong,{children:"HOT"}),": >90% or <20% (unusual spikes/drops)"]}),"\n",(0,t.jsxs)(n.li,{children:["\u2744\ufe0f ",(0,t.jsx)(n.strong,{children:"COLD"}),": 30-80% (comfortable range)"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"3-co2-model",children:"3. CO2 Model"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Training Range"}),": 350-900 ppm (safe CO2 levels)"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Detection"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\ud83d\udd25 ",(0,t.jsx)(n.strong,{children:"HOT"}),": >1000 ppm (dangerous CO2)"]}),"\n",(0,t.jsxs)(n.li,{children:["\u2744\ufe0f ",(0,t.jsx)(n.strong,{children:"COLD"}),": 350-900 ppm (safe levels)"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"ml-service-architecture",children:"ML Service Architecture"}),"\n",(0,t.jsx)(n.mermaid,{value:'graph TB\n    subgraph "ML Service Container"\n        A[FastAPI App]\n        B[Model Loader]\n        C[Temperature Model]\n        D[Humidity Model]\n        E[CO2 Model]\n    end\n    \n    A --\x3e B\n    B --\x3e C\n    B --\x3e D\n    B --\x3e E\n    \n    F[Backend Request] --\x3e A\n    A --\x3e G[Prediction Response]\n    \n    style C fill:#ff6b6b,color:#fff\n    style D fill:#4dabf7,color:#fff\n    style E fill:#51cf66,color:#fff'}),"\n",(0,t.jsx)(n.h2,{id:"api-endpoint",children:"API Endpoint"}),"\n",(0,t.jsx)(n.h3,{id:"post-predict",children:"POST /predict"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Request"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "source": "sensor_001",\n  "metric_type": "temperature",\n  "value": 45.5\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Response"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "label": "HOT",\n  "uri": "https://schema.org/Warning",\n  "desc": "Temperature Anomaly Detected"\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"auto-training-on-startup",children:"Auto-Training on Startup"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"entrypoint.sh"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n\n# Check if models exist\nif [ ! -f "/app/app/models/temperature_model.pkl" ]; then\n    echo "Models not found. Training..."\n    python3 /app/train_models.py\nfi\n\n# Start FastAPI\nuvicorn app.main:app --host 0.0.0.0 --port 8000\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"train_models.py"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"def train_all_models():\n    # Temperature\n    temp_data = generate_normal_data(15, 35, 10000)\n    temp_model = IsolationForest(contamination=0.1)\n    temp_model.fit(temp_data)\n    joblib.dump(temp_model, 'models/temperature_model.pkl')\n    \n    # Humidity\n    humidity_data = generate_normal_data(30, 80, 10000)\n    humidity_model = IsolationForest(contamination=0.1)\n    humidity_model.fit(humidity_data)\n    joblib.dump(humidity_model, 'models/humidity_model.pkl')\n    \n    # CO2\n    co2_data = generate_normal_data(350, 900, 10000)\n    co2_model = IsolationForest(contamination=0.1)\n    co2_model.fit(co2_data)\n    joblib.dump(co2_model, 'models/co2_model.pkl')\n"})}),"\n",(0,t.jsx)(n.h2,{id:"data-distribution",children:"Data Distribution"}),"\n",(0,t.jsx)(n.p,{children:"Typical distribution after classification:"}),"\n",(0,t.jsx)(n.mermaid,{value:'pie title Data Classification Distribution\n    "HOT (Anomalies)" : 35\n    "COLD (Normal)" : 65\n    "WARM (Reserved)" : 0'}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Observations"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"~35% HOT: Anomalies requiring immediate attention"}),"\n",(0,t.jsx)(n.li,{children:"~65% COLD: Normal sensor readings"}),"\n",(0,t.jsx)(n.li,{children:"WARM tier: Reserved for future use (configurable threshold)"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"performance-metrics",children:"Performance Metrics"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Metric"}),(0,t.jsx)(n.th,{children:"Value"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Inference Time"})}),(0,t.jsx)(n.td,{children:"<50ms per prediction"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Model Size"})}),(0,t.jsx)(n.td,{children:"~1.5 MB each"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Training Time"})}),(0,t.jsx)(n.td,{children:"<10 seconds all models"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Accuracy"})}),(0,t.jsx)(n.td,{children:"~90% anomaly detection"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Throughput"})}),(0,t.jsx)(n.td,{children:"500+ predictions/sec"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"classification-flow-in-backend",children:"Classification Flow in Backend"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'@Service\npublic class DataClassificationService {\n    \n    private final MLClient mlClient;\n    private final RedisTemplate redisTemplate;\n    private final WarmMongoTemplate warmMongo;\n    private final ColdMongoTemplate coldMongo;\n    \n    public void classifyAndStore(List<SensorData> batch) {\n        // Classify each record\n        List<ClassifiedData> classified = batch.stream()\n            .map(data -> mlClient.predict(data))\n            .collect(Collectors.toList());\n        \n        // Route to appropriate storage\n        Map<String, List<ClassifiedData>> grouped = \n            classified.stream().collect(Collectors.groupingBy(ClassifiedData::getLabel));\n        \n        // Store HOT in Redis (TTL 1h)\n        if (grouped.containsKey("HOT")) {\n            List<ClassifiedData> hotData = grouped.get("HOT");\n            hotData.forEach(d -> redisTemplate.opsForValue()\n                .set(d.getId(), d, 3600, TimeUnit.SECONDS));\n            log.info("Stored {} HOT records to Redis", hotData.size());\n        }\n        \n        // Store COLD in MongoDB\n        if (grouped.containsKey("COLD")) {\n            List<ClassifiedData> coldData = grouped.get("COLD");\n            coldMongo.insertAll(coldData);\n            log.info("Stored {} COLD records to MongoDB", coldData.size());\n        }\n    }\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"warm-tier-future-enhancement",children:"WARM Tier (Future Enhancement)"}),"\n",(0,t.jsx)(n.p,{children:"Currently WARM tier is reserved. Potential use cases:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Moderate anomalies (not urgent like HOT)"}),"\n",(0,t.jsx)(n.li,{children:"Important events for historical analysis"}),"\n",(0,t.jsx)(n.li,{children:"Configurable thresholds between HOT and COLD"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"./tech-stack",children:"Technology Stack \u2192"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"./overview",children:"Back to Overview"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}}}]);