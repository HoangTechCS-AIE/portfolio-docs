"use strict";(self.webpackChunkportfolio_docs=self.webpackChunkportfolio_docs||[]).push([[9010],{6091(e,n,r){r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"ai-chag/architecture","title":"System Architecture","description":"High-Level Architecture","source":"@site/docs/ai-chag/architecture.md","sourceDirName":"ai-chag","slug":"/ai-chag/architecture","permalink":"/portfolio-docs/en/docs/ai-chag/architecture","draft":false,"unlisted":false,"editUrl":"https://github.com/your-username/portfolio-docs/tree/main/docs/ai-chag/architecture.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"aiChagSidebar","previous":{"title":"AI-Chag 2025 Overview","permalink":"/portfolio-docs/en/docs/ai-chag/overview"},"next":{"title":"AI Components Deep Dive","permalink":"/portfolio-docs/en/docs/ai-chag/ai-components"}}');var t=r(4848),s=r(8453);const l={sidebar_position:2},a="System Architecture",d={},c=[{value:"High-Level Architecture",id:"high-level-architecture",level:2},{value:"Clean Architecture Layers",id:"clean-architecture-layers",level:2},{value:"Component Breakdown",id:"component-breakdown",level:2},{value:"1. Indexing Service (<code>indexing/</code>)",id:"1-indexing-service-indexing",level:3},{value:"2. Retrieval API (<code>retrieve/</code>)",id:"2-retrieval-api-retrieve",level:3},{value:"3. Vector Database (Qdrant)",id:"3-vector-database-qdrant",level:3},{value:"Data Flow Example",id:"data-flow-example",level:2},{value:"Indexing Flow",id:"indexing-flow",level:3},{value:"Retrieval Flow",id:"retrieval-flow",level:3},{value:"Deployment Architecture",id:"deployment-architecture",level:2},{value:"Next Steps",id:"next-steps",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"system-architecture",children:"System Architecture"})}),"\n",(0,t.jsx)(n.h2,{id:"high-level-architecture",children:"High-Level Architecture"}),"\n",(0,t.jsx)(n.mermaid,{value:'graph TB\n    subgraph "Frontend"\n        UI[React/Vite Client]\n    end\n    \n    subgraph "Backend Services"\n        API[Retrieval API FastAPI]\n        INDEXING[Indexing Service Python]\n    end\n    \n    subgraph "AI Components"\n        CLIP[CLIP Model Sentence Transformers]\n        EMBED[Embedding Service]\n    end\n    \n    subgraph "Storage"\n        QDRANT[(Qdrant Vector Database)]\n        KEYFRAMES[Keyframes File Storage]\n    end\n    \n    UI --\x3e|HTTP Request| API\n    INDEXING --\x3e|Load Images| KEYFRAMES\n    INDEXING --\x3e|Generate Embeddings| CLIP\n    INDEXING --\x3e|Store Vectors| QDRANT\n    API --\x3e|Query| EMBED\n    EMBED --\x3e|Generate Query Embedding| CLIP\n    API --\x3e|Search Similar| QDRANT\n    QDRANT --\x3e|Return Results| API\n    API --\x3e|JSON Response| UI\n    \n    style CLIP fill:#ff6b6b,stroke:#c92a2a,stroke-width:3px,color:#fff\n    style EMBED fill:#ff6b6b,stroke:#c92a2a,stroke-width:3px,color:#fff\n    style QDRANT fill:#4dabf7,stroke:#1971c2,stroke-width:3px,color:#fff'}),"\n",(0,t.jsx)(n.h2,{id:"clean-architecture-layers",children:"Clean Architecture Layers"}),"\n",(0,t.jsx)(n.mermaid,{value:'graph TB\n    subgraph "Presentation Layer"\n        FAST[FastAPI Routes api/routers/qa.py]\n        MAIN[Main Entry main.py]\n    end\n    \n    subgraph "Application Layer"\n        QA[QA Service application/qa.py]\n        KIS[KIS Service]\n        TRAKE[TRAKE Service]\n    end\n    \n    subgraph "Domain Layer"\n        INTERFACE[BaseRetrievalService interfaces/base_retrieval.py]\n        MODELS[Domain Models BaseModel]\n    end\n    \n    subgraph "Infrastructure Layer"\n        EMB_INFRA[Embedding Client infra/embedding.py]\n        QDRANT_INFRA[Qdrant Client infra/qdrant.py]\n    end\n    \n    subgraph "External"\n        CLIP_EXT[CLIP Model]\n        QDRANT_EXT[(Qdrant DB)]\n    end\n    \n    FAST --\x3e QA\n    MAIN --\x3e FAST\n    QA --\x3e INTERFACE\n    KIS --\x3e INTERFACE\n    TR AKE --\x3e INTERFACE\n    \n    INTERFACE --\x3e EMB_INFRA\n    INTERFACE --\x3e QDRANT_INFRA\n    \n    EMB_INFRA --\x3e CLIP_EXT\n    QDRANT_INFRA --\x3e QDRANT_EXT\n    \n    style INTERFACE fill:#fab005,stroke:#f08c00,stroke-width:2px\n    style CLIP_EXT fill:#ff6b6b,stroke:#c92a2a,stroke-width:3px,color:#fff\n    style QDRANT_EXT fill:#4dabf7,stroke:#1971c2,stroke-width:3px,color:#fff'}),"\n",(0,t.jsx)(n.h2,{id:"component-breakdown",children:"Component Breakdown"}),"\n",(0,t.jsxs)(n.h3,{id:"1-indexing-service-indexing",children:["1. Indexing Service (",(0,t.jsx)(n.code,{children:"indexing/"}),")"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Purpose"}),": Generate CLIP embeddings from video keyframes and upload to Qdrant"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Flow"}),":"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Discover keyframes from file system"}),"\n",(0,t.jsx)(n.li,{children:"Load images in batches (batch_size: 32)"}),"\n",(0,t.jsx)(n.li,{children:"Generate embeddings using CLIP model"}),"\n",(0,t.jsx)(n.li,{children:"Create metadata (keyframe_path, frame_idx, video_id)"}),"\n",(0,t.jsx)(n.li,{children:"Upload to Qdrant with vectors + payload"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Key Files"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"main.py"})," - Entry point, supports fresh/precomputed modes"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"application/fresh_run.py"})," - Fresh embedding generation"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"infra/embedding_service.py"})," - CLIP model wrapper"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"infra/qdrant.py"})," - Qdrant client wrapper"]}),"\n"]}),"\n",(0,t.jsxs)(n.h3,{id:"2-retrieval-api-retrieve",children:["2. Retrieval API (",(0,t.jsx)(n.code,{children:"retrieve/"}),")"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Purpose"}),": Serve search requests and return relevant video frames"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Flow"}),":"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Receive text query from client"}),"\n",(0,t.jsx)(n.li,{children:"Generate query embedding using CLIP"}),"\n",(0,t.jsx)(n.li,{children:"Search Qdrant for similar vectors (cosine similarity)"}),"\n",(0,t.jsx)(n.li,{children:"Extract video_id and frame_idx from results"}),"\n",(0,t.jsx)(n.li,{children:"Return ranked results to client"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Key Files"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"main.py"})," - FastAPI application"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"api/routers/qa.py"})," - Query endpoint"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"application/qa.py"})," - QA service logic"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"infra/qdrant.py"})," - Qdrant search client"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"3-vector-database-qdrant",children:"3. Vector Database (Qdrant)"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Configuration"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Collection: ",(0,t.jsx)(n.code,{children:"video_keyframes"})]}),"\n",(0,t.jsx)(n.li,{children:"Vector size: 512 dimensions"}),"\n",(0,t.jsx)(n.li,{children:"Distance metric: Cosine similarity"}),"\n",(0,t.jsx)(n.li,{children:"Ports: 6333 (HTTP), 6334 (gRPC)"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"data-flow-example",children:"Data Flow Example"}),"\n",(0,t.jsx)(n.h3,{id:"indexing-flow",children:"Indexing Flow"}),"\n",(0,t.jsx)(n.mermaid,{value:"flowchart LR\n    A[Keyframes JPG Files] --\x3e B[Load Image PIL]\n    B --\x3e C[CLIP Encode 512-dim vector]\n    C --\x3e D[Create Point ID + Vector + Metadata]\n    D --\x3e E[(Qdrant Collection)]\n    \n    style C fill:#ff6b6b,color:#fff\n    style E fill:#4dabf7,color:#fff"}),"\n",(0,t.jsx)(n.h3,{id:"retrieval-flow",children:"Retrieval Flow"}),"\n",(0,t.jsx)(n.mermaid,{value:"flowchart LR\n    A[Text Query 'dog running'] --\x3e B[CLIP Encode 512-dim vector]\n    B --\x3e C[Qdrant Search Cosine Similarity]\n    C --\x3e D[Extract Results video_id + frame_idx]\n    D --\x3e E[JSON Response]\n    \n    style B fill:#ff6b6b,color:#fff\n    style C fill:#4dabf7,color:#fff"}),"\n",(0,t.jsx)(n.h2,{id:"deployment-architecture",children:"Deployment Architecture"}),"\n",(0,t.jsx)(n.mermaid,{value:'graph TB\n    subgraph "Docker Compose"\n        NGINX[Nginx Proxy Port 80]\n        FE[Frontend Vite Dev Port 5173]\n        BE[Retrieval API FastAPI Port 8000]\n        QD[Qdrant Vector DB 6333/6334]\n    end\n    \n    USER[User Browser] --\x3e NGINX\n    NGINX --\x3e FE\n    NGINX --\x3e BE\n    BE --\x3e QD\n    \n    style QD fill:#4dabf7,stroke:#1971c2,stroke-width:3px,color:#fff'}),"\n",(0,t.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"./ai-components",children:"AI Components Deep Dive \u2192"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"./tech-stack",children:"Technology Stack Details \u2192"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}}}]);